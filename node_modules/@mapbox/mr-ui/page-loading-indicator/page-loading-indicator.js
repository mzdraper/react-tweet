'use strict';

exports.__esModule = true;
var BASE_CLASSNAME = 'page-loading-indicator h6 fixed top left opacity50 round-full';
var ENTER_CLASSNAME = 'page-loading-indicator-enter';
var LEAVE_CLASSNAME = 'page-loading-indicator-leave';
var el = void 0;
var canEnd = void 0;
var mounted = false;

function createElement() {
  el = document.createElement('div');
  el.setAttribute('data-test', 'page-loading-indicator');
  el.className = BASE_CLASSNAME;
}

function start() {
  if (mounted) {
    return;
  }
  mounted = true;
  if (!el) {
    createElement();
  }
  document.body.appendChild(el);
  // Next-tick delay to allow the node to be added and ready for a transition.
  canEnd = new Promise(function (resolve) {
    setTimeout(function () {
      el.className += ' ' + ENTER_CLASSNAME;
      setTimeout(resolve, 300);
    }, 0);
  });
  return el;
}

function end() {
  if (!mounted) {
    return Promise.resolve();
  }
  return (canEnd || Promise.resolve()).then(function () {
    new Promise(function (resolve) {
      el.classList.remove(ENTER_CLASSNAME);
      el.classList.add(LEAVE_CLASSNAME);
      setTimeout(function () {
        mounted = false;
        canEnd = null;
        el.parentNode.removeChild(el);
        el.className = BASE_CLASSNAME;
        resolve();
      }, 300);
    });
  });
}

// For tests
function _reset() {
  el = null;
  canEnd = null;
  mounted = false;
}

exports.default = { start: start, end: end, _reset: _reset };