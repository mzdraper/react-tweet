'use strict';

const autoprefixer = require('autoprefixer');
const postcss = require('postcss');
const initPostcssCustomProperties = require('postcss-custom-properties');
const postcssCustomMedia = require('postcss-custom-media');
const assemblyMediaQueries = require('@mapbox/assembly/src/media-queries.json');
const browsersList = require('./browsers-list');
const allVariables = require('./all-variables');

const customProperties = initPostcssCustomProperties({
  preserve: false,
  variables: allVariables
});

const plugins = [
  customProperties,
  postcssCustomMedia({ extensions: assemblyMediaQueries }),
  autoprefixer({
    browsers: browsersList
  })
];

function process(css) {
  return postcss(plugins)
    .process(css)
    .then((result) => result.css);
}

module.exports = {
  plugins,
  process
};
