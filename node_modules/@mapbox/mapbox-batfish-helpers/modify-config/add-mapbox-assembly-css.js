'use strict';

const resolve = require('./util/resolve');

module.exports = function addMapboxAssemblyCss(batfishConfig) {
  let mapboxAssembly;
  try {
    mapboxAssembly = require('@mapbox/mbx-assembly');
  } catch (error) {
    if (error.code === 'MODULE_NOT_FOUND') {
      throw new Error(
        'You must install @mapbox/mbx-assembly before using addMapboxAssembly'
      );
    } else {
      throw error;
    }
  }

  const result = Object.assign({}, batfishConfig, {
    browserslist: mapboxAssembly.browsersList,
    postcssPlugins: mapboxAssembly.postcssPipeline.plugins
  });
  result.stylesheets = [
    resolve('@mapbox/mbx-assembly/dist/assembly.css')
  ].concat(result.stylesheets || []);

  return result;
};
