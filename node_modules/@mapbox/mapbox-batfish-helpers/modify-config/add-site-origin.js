'use strict';

const gitBranch = require('git-branch');
const getDeployEnv = require('./util/get-deploy-env');
const constants = require('./constants');

module.exports = function addSiteOrigin(batfishConfig) {
  const deployEnv = getDeployEnv();
  let branch = 'dev-pages';
  try {
    branch = gitBranch.sync();
  } catch (error) {
    // No Git branch.
  }

  let siteOrigin;
  if (deployEnv === constants.DEPLOY_ENV_PRODUCTION) {
    siteOrigin =
      branch === 'hey-pages'
        ? constants.ORIGIN_HEY
        : constants.ORIGIN_PRODUCTION;
  } else {
    siteOrigin = constants.ORIGIN_STAGING;
  }

  return Object.assign({}, batfishConfig, {
    siteOrigin
  });
};
